<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage
    x:Class="DietMVP.Pages.Doctor.NewPatientPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="{StaticResource Color.Background}"
    Title="Yeni Hasta"
    Padding="{OnPlatform iOS='16,56,16,12', Android='16,32,16,12'}">

    <ContentPage.Resources>
        <!-- Yerel alan etiketleri -->
        <Style x:Key="FieldLabel" TargetType="Label">
            <Setter Property="TextColor" Value="{AppThemeBinding Light=#374151, Dark=#CBD5E1}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="2,0,0,4"/>
        </Style>
        <Style x:Key="HintText" TargetType="Label">
            <Setter Property="TextColor" Value="{AppThemeBinding Light=#6B7280, Dark=#94A3B8}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </ContentPage.Resources>

    <Grid>

        <ScrollView>
            <VerticalStackLayout Spacing="14">

                <!-- HERO -->
                <Border StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="18"/>
                    </Border.StrokeShape>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#8B5CF6" Offset="0"/>
                            <GradientStop Color="#2563EB" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>

                    <Grid Padding="16" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                        <Border WidthRequest="44" HeightRequest="44" StrokeThickness="0"
                                BackgroundColor="#33111827" StrokeShape="RoundRectangle 22"
                                VerticalOptions="Center">
                            <Label Text="➕" FontSize="22" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                        </Border>

                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Yeni Hasta" TextColor="White" FontSize="22" FontAttributes="Bold"/>
                            <Label Text="Hızlıca hesap oluştur ve su hedefini ayarla."
                                   TextColor="#E5E7EB" FontSize="13"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- FORM KARTI -->
                <Frame Style="{StaticResource Card}" Padding="14" Margin="0,6">
                    <VerticalStackLayout Spacing="12">

                        <!-- Ad Soyad -->
                        <VerticalStackLayout>
                            <Label Text="Ad Soyad" Style="{StaticResource FieldLabel}" />
                            <Entry x:Name="FullNameEntry" Placeholder="Örn: Ayşe Yılmaz" ReturnType="Next"/>
                        </VerticalStackLayout>

                        <!-- E-posta -->
                        <VerticalStackLayout>
                            <Label Text="E-posta" Style="{StaticResource FieldLabel}" />
                            <Entry x:Name="EmailEntry" Placeholder="ornek@eposta.com" Keyboard="Email" ReturnType="Next"/>
                        </VerticalStackLayout>

                        <!-- Şifre + Göster -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <VerticalStackLayout>
                                <Label Text="Geçici Şifre" Style="{StaticResource FieldLabel}" />
                                <Entry x:Name="PwEntry" Placeholder="En az 6 karakter" IsPassword="True" ReturnType="Next"/>
                                <Label Text="Bu şifreyi hastaya ileteceksin. Hasta ilk girişte değiştirebilir."
                                       Style="{StaticResource HintText}" />
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" VerticalOptions="End">
                                <CheckBox x:Name="ShowPw" CheckedChanged="OnShowPwChanged" />
                                <Label Text="Göster" FontSize="11" HorizontalTextAlignment="Center"
                                       TextColor="{AppThemeBinding Light=#6B7280, Dark=#94A3B8}"/>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Su hedefi -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <VerticalStackLayout>
                                <Label Text="Günlük Su Hedefi (ml)" Style="{StaticResource FieldLabel}" />
                                <Entry x:Name="WaterEntry" Placeholder="2000" Text="2000" Keyboard="Numeric" ReturnType="Done"/>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" VerticalOptions="End">
                                <Label Text="Öneri: 2000–2500" Style="{StaticResource HintText}" />
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Uyarı/mesaj -->
                        <Label x:Name="Msg" IsVisible="False" TextColor="{StaticResource Color.Danger}" />

                    </VerticalStackLayout>
                </Frame>

                <!-- Aksiyonlar -->
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                    <Button Text="Oluştur" Clicked="OnCreate" Style="{StaticResource Btn.Primary}" />
                    <Button Grid.Column="1" Text="Temizle" Clicked="OnReset" Style="{StaticResource Btn.Outline}" />
                </Grid>

                <BoxView HeightRequest="24" Opacity="0"/>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Animasyonlu Busy Overlay (ortada kart) -->
        <Grid x:Name="BusyOverlay" IsVisible="False" InputTransparent="False"
              BackgroundColor="{AppThemeBinding Light=#00000066, Dark=#00000099}">
            <Border x:Name="BusyCard" Padding="16" StrokeThickness="0" Opacity="0" Scale="0.96"
                    BackgroundColor="{AppThemeBinding Light=#FFFFFFFF, Dark=#172033F0}"
                    HorizontalOptions="Center" VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18"/>
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True"/>
                    <Label x:Name="BusyText" Text="Lütfen bekleyin..."
                           TextColor="{AppThemeBinding Light=#111827, Dark=#E5E7EB}" FontAttributes="Bold"/>
                </HorizontalStackLayout>
            </Border>
        </Grid>

        <!-- Yumuşak toast -->
        <Grid x:Name="ToastHost" Padding="16" IsVisible="False" InputTransparent="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="32" />
            </Grid.RowDefinitions>
            <Frame Grid.Row="1" CornerRadius="14" HasShadow="False" Padding="12"
                   BackgroundColor="#CC111827" HorizontalOptions="Center" Opacity="0">
                <Label x:Name="ToastText" TextColor="White" />
            </Frame>
        </Grid>

    </Grid>
</ContentPage>
