<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage
    x:Class="DietMVP.Pages.Doctor.SettingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Ayarlar"
    Padding="{OnPlatform iOS='16,56,16,12', Android='16,32,16,12'}"
    BackgroundColor="{StaticResource Color.Background}">

    <!-- Sayfaya özel minik stiller -->
    <ContentPage.Resources>
        <!-- Yumuşak kart -->
        <Style x:Key="SoftCard" TargetType="Border">
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="18"/>
                </Setter.Value>
            </Setter>
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FFFFFF, Dark=#111827}"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Margin" Value="0,8"/>
            <Setter Property="Shadow">
                <Shadow Brush="#000" Opacity="0.06" Radius="12"/>
            </Setter>
        </Style>

        <!-- İnce yazı -->
        <Style x:Key="Muted" TargetType="Label">
            <Setter Property="TextColor" Value="{StaticResource Color.Muted}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Basit giriş çerçevesi -->
        <Style x:Key="InputWrap" TargetType="Border">
            <Setter Property="Stroke" Value="#E5E7EB"/>
            <Setter Property="Background" Value="{AppThemeBinding Light=#FAFAFA, Dark=#0B1220}"/>
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="12"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Padding" Value="10,6"/>
        </Style>
    </ContentPage.Resources>

    <Grid>

        <ScrollView>
            <VerticalStackLayout Spacing="14">

                <!-- HERO -->
                <Border>
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20"/>
                    </Border.StrokeShape>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#8B5CF6" Offset="0"/>
                            <GradientStop Color="#2563EB" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>

                    <Grid Padding="16" ColumnDefinitions="Auto,*" ColumnSpacing="14">
                        <Border WidthRequest="54" HeightRequest="54" BackgroundColor="#33111827" StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="27"/>
                            </Border.StrokeShape>
                            <Label Text="⚙️" FontSize="26" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                        </Border>

                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Text="Ayarlar" TextColor="White" FontSize="22" FontAttributes="Bold"/>
                            <Label Text="Hesap ve güvenlik" TextColor="#E5E7EB" FontSize="13"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Hesap bilgisi -->
                <Border Style="{StaticResource SoftCard}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Hesap" FontAttributes="Bold" FontSize="16"/>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                            <Label Text="E-posta:" Style="{StaticResource Muted}" />
                            <Label x:Name="LblEmail" Grid.Column="1" FontAttributes="Bold"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- E-posta değiştir -->
                <Border Style="{StaticResource SoftCard}">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="E-posta Değiştir" FontAttributes="Bold" FontSize="16"/>

                        <Border Style="{StaticResource InputWrap}">
                            <Entry x:Name="NewEmail" Keyboard="Email" Placeholder="yeni@email.com" />
                        </Border>

                        <Border Style="{StaticResource InputWrap}">
                            <Entry x:Name="NewEmail2" Keyboard="Email" Placeholder="yeni@email.com (tekrar)" />
                        </Border>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Border Style="{StaticResource InputWrap}">
                                <Entry x:Name="PwdForEmail" IsPassword="True" Placeholder="Mevcut şifre (güvenlik için)" />
                            </Border>
                            <CheckBox Grid.Column="1" VerticalOptions="Center" CheckedChanged="TogglePwdForEmail"/>
                        </Grid>

                        <Button Text="E-postayı Güncelle" Clicked="OnUpdateEmail" Style="{StaticResource Btn.Primary}" />
                        <Label Text="Yeni e-posta için doğrulama maili gönderilir."
                               Style="{StaticResource Muted}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Şifre değiştir -->
                <Border Style="{StaticResource SoftCard}">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Şifre Değiştir" FontAttributes="Bold" FontSize="16"/>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Border Style="{StaticResource InputWrap}">
                                <Entry x:Name="OldPwd" IsPassword="True" Placeholder="Mevcut şifre" />
                            </Border>
                            <CheckBox Grid.Column="1" VerticalOptions="Center" CheckedChanged="TogglePwdOld"/>
                        </Grid>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Border Style="{StaticResource InputWrap}">
                                <Entry x:Name="NewPwd" IsPassword="True" Placeholder="Yeni şifre (en az 8 karakter)" />
                            </Border>
                            <CheckBox Grid.Column="1" VerticalOptions="Center" CheckedChanged="TogglePwdNew"/>
                        </Grid>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Border Style="{StaticResource InputWrap}">
                                <Entry x:Name="NewPwd2" IsPassword="True" Placeholder="Yeni şifre (tekrar)" />
                            </Border>
                            <CheckBox Grid.Column="1" VerticalOptions="Center" CheckedChanged="TogglePwdNew2"/>
                        </Grid>

                        <Button Text="Şifreyi Güncelle" Clicked="OnUpdatePassword" Style="{StaticResource Btn.Primary}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Hata/mesaj -->
                <Label x:Name="Msg" IsVisible="False" TextColor="#B91C1C" />

                <!-- Çıkış -->
                <Button Text="Çıkış Yap" Clicked="OnSignOut"
                        BackgroundColor="#EF4444" TextColor="White" CornerRadius="12"/>

                <BoxView HeightRequest="24" Opacity="0"/>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Busy Overlay (şık) -->
        <Grid x:Name="BusyOverlay" IsVisible="False" InputTransparent="False">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="40"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="1" x:Name="BusyCard" TranslationY="40" Opacity="0"
                    BackgroundColor="{AppThemeBinding Light=#FFFFFFFF, Dark=#172033F0}"
                    StrokeThickness="0" Padding="14" Margin="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18"/>
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True"/>
                    <Label x:Name="BusyText" Text="Lütfen bekleyin..." TextColor="{AppThemeBinding Light=#111827, Dark=#E5E7EB}" FontAttributes="Bold" />
                </HorizontalStackLayout>
            </Border>
        </Grid>

        <!-- Toast -->
        <Grid x:Name="ToastHost" Padding="16" IsVisible="False" InputTransparent="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="32" />
            </Grid.RowDefinitions>
            <Frame Grid.Row="1" CornerRadius="14" HasShadow="False" Padding="12"
                   BackgroundColor="#CC111827" HorizontalOptions="Center">
                <Label x:Name="ToastText" TextColor="White"/>
            </Frame>
        </Grid>

    </Grid>
</ContentPage>
